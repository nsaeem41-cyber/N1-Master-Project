<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N One | Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©</title>
    <style>
        /* ================= ØªØµÙ…ÙŠÙ… ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø·Ø§Ø¹Ù… (Express Shop) ================= */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #ffffff; margin: 0; padding: 0;
            user-select: none; display: flex; flex-direction: column;
            align-items: center; min-height: 100vh;
        }

        /* 1. Ø§Ù„ØªØ±ÙˆÙŠØ³Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        .shop-header {
            width: 100%; background: #1a237e; color: white;
            padding: 20px 0; text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .shop-brand { font-size: 24px; font-weight: 900; letter-spacing: 1px; }
        .gold { color: #d4af37; }
        .sub-title { font-size: 14px; opacity: 0.8; margin-top: 5px; }

        /* 2. ÙƒØ§Ø±Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .order-container {
            width: 90%; max-width: 400px;
            background: #f8f9fa; padding: 30px; border-radius: 20px;
            border: 2px solid #e0e0e0; box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }

        /* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø£Ø© (Auto-ID) */
        .shop-badge {
            background: #e3f2fd; color: #1565c0; padding: 10px;
            border-radius: 10px; text-align: center; font-weight: bold;
            margin-bottom: 25px; border: 1px dashed #1565c0;
        }

        /* Ø§Ù„Ø­Ù‚ÙˆÙ„ */
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-weight: bold; color: #333; margin-bottom: 8px; }
        
        .form-input {
            width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 12px;
            font-size: 16px; text-align: center; transition: 0.3s;
            box-sizing: border-box; outline: none;
        }
        .form-input:focus { border-color: #d4af37; background: white; transform: scale(1.02); }

        /* Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ */
        .btn-submit {
            width: 100%; padding: 18px; background: #1a237e; color: white;
            border: none; border-radius: 12px; font-size: 18px; font-weight: bold;
            cursor: pointer; transition: 0.3s;
            box-shadow: 0 5px 15px rgba(26, 35, 126, 0.2);
        }
        .btn-submit:active { transform: scale(0.95); }

        /* Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ */
        .status-msg {
            margin-top: 20px; text-align: center; font-size: 14px; color: #2e7d32;
            display: none; animation: popIn 0.5s ease;
        }
        @keyframes popIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬ */
        .logout-link {
            margin-top: 30px; color: #999; text-decoration: underline; 
            cursor: pointer; font-size: 12px;
        }

        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 5000; display: flex;
            justify-content: center; align-items: center; flex-direction: column;
        }
    </style>
</head>
<body>

    <div id="loader">
        <h2 style="color:#1a237e;">N <span style="color:#d4af37">One</span></h2>
        <p>Ø¬Ø§Ø±ÙŠ ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ù†Ø´Ø£Ø©... ğŸ¢</p>
    </div>

    <div class="shop-header">
        <div class="shop-brand">N <span class="gold">One</span> Business</div>
        <div class="sub-title">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©</div>
    </div>

    <div class="order-container">
        
        <div class="shop-badge">
            ğŸ¢ <span id="shop-name-display">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
        </div>

        <div class="form-group">
            <label class="form-label">ğŸ’° Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨ (Ø§Ù„ØªØ­ØµÙŠÙ„)</label>
            <input type="number" id="order_value" class="form-input" placeholder="0.00 Ø¯.Ø£">
        </div>

        <div class="form-group">
            <label class="form-label">ğŸ“ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© / Ø§Ù„ÙˆØ¬Ù‡Ø©</label>
            <input type="text" id="order_dest" class="form-input" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø¬Ø¨ÙŠÙ‡Ø©ØŒ Ø´Ø§Ø±Ø¹ Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©">
        </div>

        <button class="btn-submit" onclick="sendShopOrder()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ù…Ø±ÙƒØ² ğŸ“¡</button>

        <div id="success-msg" class="status-msg">
            âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!<br>Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ø¢Ù† ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.
        </div>
    </div>

    <div class="logout-link" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù…Ù†Ø´Ø£Ø©</div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycby8Lvhri3wDGXFwXY2EPKy_sf6vrIEAyPVGreob8gDe_mx9EbpqWsqqR511LXdqjjU1/exec";
        
        let currentShop = null;

        window.onload = function() {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            currentShop = JSON.parse(localStorage.getItem('currentUser'));
            
            if (!currentShop) {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø³Ø¬Ù„Ø§Ù‹ØŒ Ù†Ø­ÙˆÙ„Ù‡ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
                window.location.replace('index.html');
                return;
            }

            // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Auto-ID)
            document.getElementById('shop-name-display').innerText = currentShop.name;
            document.getElementById('loader').style.display = 'none';
        };

        async function sendShopOrder() {
            const val = document.getElementById('order_value').value;
            const dest = document.getElementById('order_dest').value;

            if (!val || !dest) {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© ÙˆØ§Ù„ÙˆØ¬Ù‡Ø© ÙÙ‚Ø· ğŸ˜Š");
                return;
            }

            // ØªØºÙŠÙŠØ± Ù†Øµ Ø§Ù„Ø²Ø±
            const btn = document.querySelector('.btn-submit');
            const originalText = btn.innerText;
            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„... â³";
            btn.disabled = true;

            // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø±Ø¨Ø·Ù‡Ø§ Ù…Ø¹ ØµÙØ­Ø© Ø§Ù„Ø´Ø±ÙƒØ§Øª
            // Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©: Ù†Ø±Ø³Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø© ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„ÙƒØ§Ø¨ØªÙ† Ù…Ø¤Ù‚ØªØ§Ù‹ ÙˆØ¨Ø´ÙƒÙ„ Ù…Ù…ÙŠØ²
            // Ø¹Ø´Ø§Ù† ÙŠØ¸Ù‡Ø± ÙÙŠ "Live Feed" Ø¹Ù†Ø¯ Ø§Ù„Ø£Ø¯Ù…Ù†
            const newOrder = {
                id: "SHOP_" + Date.now(),
                type: "order",
                client_user: currentShop.user, // Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†Ø´Ø£Ø©
                cl_name: currentShop.name,     // Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø©
                
                // Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ Ù‡Ùˆ Ø§Ù„Ø³Ø±! Ø±Ø­ ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙŠÙ…Ù†Ù‰ Ø¹Ù†Ø¯ Ø§Ù„Ø£Ø¯Ù…Ù†
                cap_name: `ğŸ”´ Ø·Ù„Ø¨ Ù…Ù†: ${currentShop.name}`, 
                cap_phone: "000",
                
                // Ù†Ø¯Ù…Ø¬ Ø§Ù„ÙˆØ¬Ù‡Ø© ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹
                pickup: `Ø§Ù„ÙˆØ¬Ù‡Ø©: ${dest}`, 
                
                val: val,
                fee: "0", // Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø´Ø±ÙƒØ© Ù„Ø§Ø­Ù‚Ø§Ù‹
                company_share: "0",
                
                cust_name: "Shop Client",
                cust_phone: "000",
                
                date: new Date().toISOString(),
                status: "new" // Ø§Ù„Ø­Ø§Ù„Ø© "Ø¬Ø¯ÙŠØ¯" Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
            };

            try {
                // Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø³ÙŠØ±ÙØ±
                await fetch(API_URL, {
                    method: 'POST', mode: 'no-cors',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ action: 'add', data: newOrder })
                });

                // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ù„ØªØ£ÙƒØ¯
                await new Promise(r => setTimeout(r, 1000));

                // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø¬Ø§Ø­
                document.getElementById('success-msg').style.display = 'block';
                
                // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„
                document.getElementById('order_value').value = '';
                document.getElementById('order_dest').value = '';

                setTimeout(() => {
                    document.getElementById('success-msg').style.display = 'none';
                    btn.innerText = originalText;
                    btn.disabled = false;
                }, 3000);

            } catch (e) {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");
                btn.innerText = originalText;
                btn.disabled = false;
            }
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.replace('index.html');
        }
    </script>
</body>
</html>
