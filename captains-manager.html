<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N One | Fleet Command & Treasury (Legacy Edition)</title>
    
    <script src="https://cdn.jsdelivr.net/gh/nsaeem41-cyber/N1-Master-Project@main/n-one-core.js"></script>

    <style>
        /* ============================================================
           ØªØµÙ…ÙŠÙ… ROYAL LIGHT - Ù‚Ù…Ø© Ø§Ù„ÙØ®Ø§Ù…Ø© ÙˆØ§Ù„ÙˆØ¶ÙˆØ­ (Legacy Theme)
           ============================================================ */
        :root {
            --primary: #0f172a;      /* ÙƒØ­Ù„ÙŠ Ù…Ù„ÙƒÙŠ Ø¹Ù…ÙŠÙ‚ */
            --bg: #f8fafc;           /* Ø®Ù„ÙÙŠØ© Ø±Ù…Ø§Ø¯ÙŠØ© Ø«Ù„Ø¬ÙŠØ© */
            --card-bg: #ffffff;      /* Ø£Ø¨ÙŠØ¶ Ù†Ø§ØµØ¹ Ù„Ù„ÙƒØ±ÙˆØª */
            --gold: #d4af37;         /* Ø°Ù‡Ø¨ÙŠ Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙˆØ§Ù„Ø­Ø¯ÙˆØ¯ */
            --gold-hover: #b4932a;   /* Ø°Ù‡Ø¨ÙŠ ØºØ§Ù…Ù‚ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ… */
            --text-main: #334155;    /* Ø±Ù…Ø§Ø¯ÙŠ ØºØ§Ù…Ù‚ Ù„Ù„Ù†ØµÙˆØµ */
            --text-light: #64748b;   /* Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­ Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
            --success: #10b981;      /* Ø£Ø®Ø¶Ø± Ù„Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ø§Ø¬Ø­Ø© */
            --danger: #ef4444;       /* Ø£Ø­Ù…Ø± Ù„Ù„Ø­Ø°Ù ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡ */
            --border: #e2e8f0;       /* Ø­Ø¯ÙˆØ¯ Ù†Ø§Ø¹Ù…Ø© */
            --shadow: 0 10px 30px rgba(0,0,0,0.04);
        }

        * { box-sizing: border-box; }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: var(--bg); margin: 0; padding: 0; 
            color: var(--text-main); user-select: none; 
        }

        /* --- Ø§Ù„Ù‡ÙŠØ¯Ø± (Navbar) --- */
        .navbar { 
            background: var(--card-bg); height: 80px; 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 0 40px; border-bottom: 3px solid var(--gold); 
            position: sticky; top: 0; z-index: 1000; 
            box-shadow: 0 4px 25px rgba(148, 163, 184, 0.15);
        }
        .brand { font-size: 26px; font-weight: 900; color: var(--primary); letter-spacing: 1px; }
        .gold-text { color: var(--gold); }
        
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .btn-close { 
            background: #fff1f2; color: var(--danger); 
            border: 1px solid #fda4af; padding: 10px 20px; 
            border-radius: 12px; cursor: pointer; transition: 0.3s; font-weight: bold;
        }
        .btn-close:hover { background: var(--danger); color: white; border-color: var(--danger); }

        .btn-treasury {
            background: var(--primary); color: var(--gold); 
            border: 2px solid var(--gold); padding: 10px 20px; 
            border-radius: 12px; font-weight: bold; cursor: pointer; 
            margin-left: 15px; box-shadow: 0 4px 10px rgba(212, 175, 55, 0.2);
            transition: all 0.3s ease; display: flex; align-items: center; gap: 8px;
        }
        .btn-treasury:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(212, 175, 55, 0.4); background: #1e293b; }

        /* --- Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --- */
        .container { 
            max-width: 1600px; margin: 30px auto; padding: 0 20px; 
            display: grid; grid-template-columns: 1fr 1fr; gap: 30px; 
        }

        /* --- Ø§Ù„ÙƒØ±ÙˆØª (Cards) --- */
        .card { 
            background: var(--card-bg); border-radius: 20px; 
            box-shadow: var(--shadow); 
            border: 1px solid var(--border); overflow: hidden; 
            transition: transform 0.2s; position: relative;
        }
        .card:hover { transform: translateY(-3px); box-shadow: 0 20px 40px rgba(0,0,0,0.08); }
        .card-full { grid-column: span 2; } 

        .card-header { 
            padding: 25px; background: #f8fafc; border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
        }
        .card-title { font-size: 18px; font-weight: 800; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        
        .card-body { padding: 30px; }

        /* --- Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ÙˆØ§Ù„Ø­Ù‚ÙˆÙ„ --- */
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 13px; color: var(--text-light); }
        
        input { 
            width: 100%; padding: 14px; border: 2px solid var(--border); border-radius: 12px; 
            outline: none; background: #fafafa; color: var(--primary); font-weight: 600;
            font-size: 15px; box-sizing: border-box; transition: 0.3s; 
        }
        input:focus { border-color: var(--primary); background: white; box-shadow: 0 0 0 4px rgba(15, 23, 42, 0.05); }

        /* --- Ø§Ù„Ø£Ø²Ø±Ø§Ø± --- */
        .btn-main { 
            width: 100%; padding: 16px; border: none; border-radius: 12px; 
            font-weight: bold; cursor: pointer; color: white; font-size: 16px; 
            transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .btn-blue { background: var(--primary); } .btn-blue:hover { background: #334155; }
        .btn-green { background: var(--success); } .btn-green:hover { background: #059669; }
        .btn-danger { background: var(--danger); } .btn-danger:hover { background: #b91c1c; }
        .btn-gold { background: var(--gold); color: white; } .btn-gold:hover { background: var(--gold-hover); }

        /* --- Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ --- */
        .table-wrapper { overflow-x: auto; max-height: 500px; border-radius: 0 0 15px 15px; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { padding: 18px; text-align: right; color: var(--text-light); border-bottom: 2px solid var(--border); background: #f8fafc; position: sticky; top: 0; z-index: 10; font-weight: 700; }
        td { padding: 18px; border-bottom: 1px solid #f1f5f9; color: var(--primary); font-weight: 600; }
        tr:hover { background: #f1f5f9; }

        /* --- Ø§Ù„Ø´Ø§Ø±Ø§Øª (Badges) --- */
        .badge { padding: 6px 12px; border-radius: 8px; font-size: 12px; font-weight: 800; display: inline-block; }
        .bg-active { background: #ecfdf5; color: var(--success); border: 1px solid #a7f3d0; }
        .bg-paused { background: #fef2f2; color: var(--danger); border: 1px solid #fecaca; }
        .bg-pending { background: #fffbeb; color: #b45309; border: 1px solid #fde68a; }

        /* --- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ØµØºÙŠØ±Ø© --- */
        .action-btn { background: none; border: none; cursor: pointer; font-size: 20px; padding: 5px; opacity: 0.6; transition: 0.2s; margin-left: 8px; }
        .action-btn:hover { opacity: 1; transform: scale(1.2); }

        /* --- Ù†Ø§ÙØ°Ø© Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ (Treasury Modal) --- */
        #treasury-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.6); z-index: 2000; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .treasury-box { 
            background: white; padding: 40px; border-radius: 20px; width: 450px; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.3); border: 4px solid var(--gold); position: relative; 
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* --- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± (Print Report) --- */
        #report-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.8); z-index: 2100; justify-content: center; align-items: center; }
        .report-paper { background: white; color: black; width: 210mm; height: 90vh; padding: 50px; overflow-y: auto; position: relative; border-radius: 15px; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        
        @media print { 
            body * { visibility: hidden; } 
            #report-modal, #report-modal * { visibility: visible; } 
            #report-modal { position: absolute; left: 0; top: 0; background: white; width: 100%; height: 100%; } 
            .report-paper { width: 100%; height: auto; box-shadow: none; padding: 0; border-radius: 0; } 
            .no-print { display: none !important; } 
        }
        
        /* --- Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ù…ÙŠÙ„ --- */
        #loading-bar { height: 4px; background: var(--gold); width: 0%; position: fixed; top: 80px; left: 0; z-index: 1001; transition: width 0.3s; }
    </style>
</head>
<body>

    <div id="loading-bar"></div>

    <nav class="navbar">
        <div class="brand">N <span class="gold-text">One</span> Fleet Command ğŸ‘®â€â™‚ï¸</div>
        <div>
            <button class="btn-treasury" onclick="toggleTreasury()">
                <span>ğŸ’°</span> Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ (Treasury)
            </button>
            <button class="btn-close" onclick="window.close()" style="margin-left: 10px;">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© âŒ</button>
        </div>
    </nav>

    <div class="container">

        <div class="card">
            <div class="card-header">
                <div class="card-title">ğŸ“ ØªØ³Ø¬ÙŠÙ„ ÙƒØ§Ø¨ØªÙ† Ø¬Ø¯ÙŠØ¯ (ØªØ¹ÙŠÙŠÙ†)</div>
                <span style="font-size:12px; color:var(--text-light);">* ÙŠØ´Ù…Ù„ ÙØ­Øµ Ø§Ù„ØªÙƒØ±Ø§Ø±</span>
            </div>
            <div class="card-body">
                <div class="form-group">
                    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" id="new_cap_name" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ø¨ØªÙ† Ø§Ù„Ø±Ø³Ù…ÙŠ">
                </div>
                <div class="form-group">
                    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨)</label>
                    <input type="tel" id="new_cap_phone" placeholder="07xxxxxxxx">
                </div>
                <div class="form-group">
                    <label>ØªØ±Ù…ÙŠØ² Ø§Ù„Ø³ÙŠØ§Ø±Ø© (User Code)</label>
                    <input type="text" id="new_cap_code" placeholder="Ù…Ø«Ù„Ø§Ù‹: C-101" style="border-color:var(--gold);">
                </div>
                <div style="display:flex; gap:15px;">
                    <div class="form-group" style="flex:1;">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</label>
                        <input type="text" id="new_cap_car" placeholder="Ù…Ø«Ù„Ø§Ù‹: Kia">
                    </div>
                    <div class="form-group" style="flex:1;">
                        <label>Ù…ÙˆØ¯ÙŠÙ„</label>
                        <input type="number" id="new_cap_model" placeholder="2022">
                    </div>
                </div>
                <button class="btn-main btn-blue" onclick="registerCaptain()">+ Ø§Ø¹ØªÙ…Ø§Ø¯ ÙˆØªØ¹ÙŠÙŠÙ† (System Check)</button>
            </div>
        </div>

        <div class="card" style="border-top: 5px solid var(--gold);">
            <div class="card-header">
                <div class="card-title">ğŸ’° Ù…Ø­ÙØ¸Ø© Ø§Ù„ÙƒØ¨Ø§ØªÙ† (Live Wallet)</div>
                <label style="display:flex; align-items:center; gap:8px; font-weight:bold; font-size:13px; cursor:pointer;">
                    <input type="checkbox" id="transfer-toggle" onchange="toggleTransfer()" checked> ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­ÙˆÙŠÙ„
                </label>
            </div>
            <div class="card-body">
                <div style="display:flex; gap:15px; margin-bottom:20px;">
                    <input type="text" id="wallet_search" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ù€ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯">
                    <button class="btn-main btn-blue" style="width:auto; padding:0 30px;" onclick="searchWallet()">Ø¨Ø­Ø«</button>
                </div>

                <div id="wallet-info" style="display:none; background:#fffbeb; padding:20px; border-radius:15px; margin-bottom:20px; border:1px solid #fde68a;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span id="w_name" style="font-weight:900; color:var(--primary); font-size:18px;">---</span>
                        <span id="w_balance" style="font-size:28px; font-weight:900; color:#b45309;">0.00 Ø¯.Ø£</span>
                    </div>
                    <div style="font-size:13px; color:#92400e; margin-top:5px;">
                        Code: <span id="w_code" style="font-weight:bold;">--</span> | Tel: <span id="w_phone" style="font-weight:bold;">--</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯.Ø£)</label>
                    <input type="number" id="wallet_amount" placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ø£Ùˆ Ø®ØµÙ…Ù‡Ø§">
                </div>
                <div style="display:flex; gap:15px;">
                    <button class="btn-main btn-green" onclick="updateBalance('add')">â• Ø´Ø­Ù† ÙÙˆØ±ÙŠ</button>
                    <button class="btn-main btn-danger" onclick="updateBalance('deduct')">â– Ø®ØµÙ… / ØºØ±Ø§Ù…Ø©</button>
                </div>
            </div>
        </div>

        <div class="card card-full">
            <div class="card-header">
                <div class="card-title">ğŸŒ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©</div>
                <button class="action-btn" onclick="refreshData()" title="ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª" style="background:#f1f5f9; padding:8px; border-radius:50%;">ğŸ”„</button>
            </div>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                            <th>Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                        </tr>
                    </thead>
                    <tbody id="requests-body">
                        <tr><td colspan="5" style="text-align:center; padding:30px; color:#94a3b8;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card card-full">
            <div class="card-header">
                <div class="card-title">ğŸ‘®â€â™‚ï¸ Ø§Ù„Ø£Ø³Ø·ÙˆÙ„ Ø§Ù„Ù†Ø´Ø·</div>
                <div style="display:flex; gap:15px; align-items:center;">
                    <div style="background:#ecfdf5; padding:8px 15px; border-radius:10px; border:1px solid #a7f3d0;">
                        <span style="color:var(--text-light); font-size:12px; font-weight:bold;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©: </span>
                        <b style="color:var(--success); font-size:16px;" id="total-fleet-bal">0.00</b> <small>Ø¯.Ø£</small>
                    </div>
                    <input type="text" id="search-active" placeholder="Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹..." oninput="renderFleet()" style="width:250px;">
                </div>
            </div>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„ÙƒØ§Ø¨ØªÙ†</th>
                            <th>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Code/Tel)</th>
                            <th>Ø§Ù„Ø±ØµÙŠØ¯</th>
                            <th>Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>ØªØ­ÙƒÙ… Ø´Ø§Ù…Ù„</th>
                        </tr>
                    </thead>
                    <tbody id="fleet-body">
                        <tr><td colspan="6" style="text-align:center; padding:50px; color:#94a3b8;">Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† ØºØ±ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <div id="treasury-modal">
        <div class="treasury-box">
            <h2 style="color:var(--primary); text-align:center; margin-top:0; border-bottom:2px solid var(--gold); padding-bottom:15px;">ğŸ¦ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ</h2>
            <p style="text-align:center; color:#64748b; margin-bottom:20px; line-height:1.6;">
                Ù‡Ù†Ø§ ÙŠØªÙ… "Ø¶Ø® Ø§Ù„Ø£Ù…ÙˆØ§Ù„" ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù….<br>
                ÙŠÙ…ÙƒÙ†Ùƒ Ø´Ø­Ù† Ø±ØµÙŠØ¯ <strong>Ù„Ù„Ù…Ù†Ø´Ø£Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©</strong> (Ù„ØªØªÙ…ÙƒÙ† Ù‡ÙŠ Ù…Ù† Ø´Ø­Ù† Ø§Ù„ÙƒØ¨Ø§ØªÙ†)ØŒ Ø£Ùˆ Ø´Ø­Ù† Ø±ØµÙŠØ¯ <strong>Ù„Ù„ÙƒØ§Ø¨ØªÙ†</strong> Ù…Ø¨Ø§Ø´Ø±Ø©.
            </p>
            
            <label>Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ (ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ø£Ùˆ Ø§Ù„ÙƒØ§Ø¨ØªÙ†)</label>
            <input type="text" id="treasury-id" placeholder="Ù…Ø«Ù„Ø§Ù‹: SHOP_01 Ø£Ùˆ C-101" style="background:#f1f5f9; margin-bottom:15px;">
            
            <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥ÙŠØ¯Ø§Ø¹Ù‡ (Ø¯.Ø£)</label>
            <input type="number" id="treasury-amount" placeholder="0.00" style="background:#f1f5f9; margin-bottom:25px;">
            
            <button class="btn-main btn-gold" onclick="treasuryDeposit()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ ğŸ’°</button>
            <button class="btn-main" onclick="toggleTreasury()" style="background:transparent; color:var(--danger); margin-top:10px;">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</button>
        </div>
    </div>

    <div id="report-modal">
        <div class="report-paper">
            <div style="text-align:center; border-bottom:4px solid var(--primary); padding-bottom:30px; margin-bottom:40px;">
                <h1 style="margin:0; font-size:36px; color:var(--primary); font-weight:900;">N <span style="color:#d4af37">One</span> Global</h1>
                <h3 style="margin:10px 0; color:#64748b;">ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ù„Ù„ÙƒØ§Ø¨ØªÙ† (Captain Full Dossier)</h3>
                <p>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: <span id="rep-date" style="font-weight:bold;"></span></p>
            </div>
            
            <div style="display:flex; justify-content:space-between; margin-bottom:40px; background:#f8fafc; padding:30px; border-radius:15px; border:1px solid #e2e8f0;">
                <div style="line-height:1.8;">
                    <strong>Ø§Ù„Ø§Ø³Ù…:</strong> <span id="rep-name">---</span><br>
                    <strong>Ø§Ù„ØªØ±Ù…ÙŠØ²:</strong> <span id="rep-code">---</span><br>
                    <strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> <span id="rep-phone">---</span>
                </div>
                <div style="text-align:left;">
                    <strong>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> <span id="rep-balance" style="font-size:24px; font-weight:900; color:var(--success);">0.00</span> Ø¯.Ø£
                    <br>
                    <strong>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</strong> â­â­â­â­â­
                </div>
            </div>

            <h4 style="border-bottom:2px solid #e2e8f0; padding-bottom:15px; color:var(--primary);">Ø³Ø¬Ù„ Ø§Ù„Ø­Ø±ÙƒØ§Øª ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª:</h4>
            <table style="width:100%; border:1px solid #e2e8f0; color:black;">
                <thead style="background:#f1f5f9;">
                    <tr>
                        <th style="padding:15px; border:1px solid #cbd5e1;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th style="padding:15px; border:1px solid #cbd5e1;">Ø§Ù„Ù†ÙˆØ¹</th>
                        <th style="padding:15px; border:1px solid #cbd5e1;">Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                    </tr>
                </thead>
                <tbody id="rep-body"></tbody>
            </table>

            <div style="margin-top:60px; display:flex; justify-content:space-between; align-items:end;">
                <div>
                    <hr style="width:200px; margin-bottom:10px; border-color:#000;">
                    <small>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</small>
                </div>
                <div style="text-align:center; border:4px solid #d4af37; padding:10px 30px; color:#d4af37; font-weight:900; transform:rotate(-5deg); opacity:0.8; border-radius:10px;">
                    N One Approved<br>âœ… OFFICIAL
                </div>
            </div>

            <button class="no-print btn-main btn-blue" onclick="window.print()" style="position:absolute; top:30px; right:30px; width:auto;">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
            <button class="no-print btn-main btn-danger" onclick="closeReport()" style="position:absolute; top:30px; right:180px; width:auto;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <script>
        // ========================================================
        // Captains Manager & Treasury Brain (v13.0 - Legacy)
        // ========================================================
        
        if (typeof N_ONE_CORE !== 'undefined') {
            N_ONE_CORE.API_URL = "https://script.google.com/macros/s/AKfycbybaX1dgu-rVIkUAz2w6H2NdYIuv3zKkmPbHON8NTRclD3H6cVgyW5SAzFfAPNcMt6g/exec";
        }

        let allData = [];
        let captains = [];
        let requests = [];
        let orders = [];
        let currentWalletCap = null;

        window.onload = async function() {
            await refreshData();
            // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ© Ù„Ø¶Ù…Ø§Ù† ØªØ²Ø§Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            setInterval(refreshDataSilent, 30000);
        };

        async function refreshData() {
            showLoading(true);
            try {
                allData = await N_ONE_CORE.fetchData('read');
                processData();
            } catch (e) { console.error(e); }
            showLoading(false);
        }

        async function refreshDataSilent() {
            try {
                allData = await N_ONE_CORE.fetchData('read');
                processData();
            } catch (e) { console.error(e); }
        }

        function processData() {
            // ÙØµÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØµÙ†ÙŠÙÙ‡Ø§
            captains = allData.filter(i => i.type === 'captain' && i.status !== 'pending').reverse();
            requests = allData.filter(i => i.type === 'captain' && i.status === 'pending');
            orders = allData.filter(i => i.type === 'order'); 
            
            renderRequests();
            renderFleet();
            updateTotalBalance();
        }

        // --- 1. ØªØ³Ø¬ÙŠÙ„ ÙƒØ§Ø¨ØªÙ† (Ù…Ø¹ ÙØ­Øµ Ø§Ù„ØªÙƒØ±Ø§Ø±) ---
        async function registerCaptain() {
            const name = document.getElementById('new_cap_name').value;
            const phone = document.getElementById('new_cap_phone').value;
            const code = document.getElementById('new_cap_code').value;
            const car = document.getElementById('new_cap_car').value;
            const model = document.getElementById('new_cap_model').value;
            
            if(!name || !phone || !code) return alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©!");

            const exists = captains.some(c => c.user === code || c.cap_phone === phone);
            if (exists) { return alert("â›” ØªÙ†Ø¨ÙŠÙ‡: Ù‡Ø°Ø§ Ø§Ù„ÙƒØ§Ø¨ØªÙ† (Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ Ø§Ù„ØªØ±Ù…ÙŠØ²) Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹!"); }

            showLoading(true);
            const newCap = {
                id: "CAP_" + Date.now(),
                user: code, pass: "123456", name: name, role: "captain", type: "captain", 
                cap_phone: phone, status: "active", pickup: `${car} ${model}`, balance: "0", emergency_used: "false"
            };

            await N_ONE_CORE.postData('add', [newCap]);
            alert("ØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­ âœ…");
            await refreshData();
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('new_cap_name').value = '';
            document.getElementById('new_cap_code').value = '';
            document.getElementById('new_cap_phone').value = '';
            document.getElementById('new_cap_car').value = '';
            document.getElementById('new_cap_model').value = '';
            showLoading(false);
        }

        // --- 2. Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„ÙÙˆØ±ÙŠØ© Ù„Ù„ÙƒØ¨Ø§ØªÙ† ---
        function searchWallet() {
            const q = document.getElementById('wallet_search').value.toLowerCase();
            const cap = captains.find(c => c.user.toLowerCase() === q || c.cap_phone.includes(q));
            
            if(cap) {
                currentWalletCap = cap;
                document.getElementById('wallet-info').style.display = 'block';
                document.getElementById('w_name').innerText = cap.name;
                document.getElementById('w_balance').innerText = parseFloat(cap.balance || 0).toFixed(2) + " Ø¯.Ø£";
                document.getElementById('w_code').innerText = cap.user;
                document.getElementById('w_phone').innerText = cap.cap_phone;
            } else {
                alert("ÙƒØ§Ø¨ØªÙ† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ âŒ");
                document.getElementById('wallet-info').style.display = 'none';
            }
        }

        async function updateBalance(action) {
            if(!currentWalletCap) return;
            const val = parseFloat(document.getElementById('wallet_amount').value);
            if(!val) return;

            const oldBal = parseFloat(currentWalletCap.balance || 0);
            const newBal = action === 'add' ? oldBal + val : oldBal - val;

            if(confirm(`ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯: ${newBal.toFixed(2)} Ø¯.Ø£ ØŸ`)) {
                showLoading(true);
                currentWalletCap.balance = newBal; // ØªØ­Ø¯ÙŠØ« Ù…Ø­Ù„ÙŠ
                document.getElementById('w_balance').innerText = newBal.toFixed(2) + " Ø¯.Ø£";
                renderFleet();
                await N_ONE_CORE.postData('update', { user: currentWalletCap.user, data: { balance: newBal } });
                alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ğŸ’°");
                showLoading(false);
            }
        }

        // --- 3. Ø·Ù„Ø¨Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ© ---
        function renderRequests() {
            const tbody = document.getElementById('requests-body');
            tbody.innerHTML = '';
            if(requests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:30px; color:#94a3b8;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</td></tr>';
                return;
            }
            requests.forEach(req => {
                tbody.innerHTML += `
                    <tr>
                        <td><strong>${req.name}</strong></td>
                        <td>${req.cap_phone}</td>
                        <td>${req.pickup || '-'}</td>
                        <td><span class="badge bg-pending">Ø§Ù†ØªØ¸Ø§Ø±</span></td>
                        <td>
                            <button class="action-btn" style="color:var(--success);" onclick="approveReq('${req.user}')">âœ…</button>
                            <button class="action-btn" style="color:var(--danger);" onclick="deleteCaptain('${req.user}')">âŒ</button>
                        </td>
                    </tr>
                `;
            });
        }

        async function approveReq(user) {
            if(confirm("Ù‚Ø¨ÙˆÙ„ Ø§Ù„ÙƒØ§Ø¨ØªÙ† ÙÙŠ Ø§Ù„Ø£Ø³Ø·ÙˆÙ„ØŸ")) {
                showLoading(true);
                await N_ONE_CORE.postData('update', { user: user, data: { status: 'active', balance: '0' } }); 
                await refreshData();
                showLoading(false);
            }
        }

        // --- 4. Ø§Ù„Ø£Ø³Ø·ÙˆÙ„ Ø§Ù„Ù†Ø´Ø· ---
        function renderFleet() {
            const tbody = document.getElementById('fleet-body');
            const q = document.getElementById('search-active').value.toLowerCase();
            tbody.innerHTML = '';

            captains.forEach(cap => {
                if(q && !cap.name.toLowerCase().includes(q) && !cap.user.toLowerCase().includes(q)) return;

                const statusBadge = cap.status === 'active' 
                    ? '<span class="badge bg-active">Ù†Ø´Ø·</span>' 
                    : '<span class="badge bg-paused">Ù…Ø¬Ù…Ø¯</span>';
                
                const freezeIcon = cap.status === 'active' ? 'â„ï¸' : 'â–¶ï¸';
                
                tbody.innerHTML += `
                    <tr>
                        <td><strong>${cap.name}</strong></td>
                        <td>${cap.user}<br>${cap.cap_phone}</td>
                        <td style="font-weight:bold; color:var(--success); font-size:16px;">${parseFloat(cap.balance||0).toFixed(2)}</td>
                        <td>${cap.emergency_used === 'true' ? 'âš ï¸' : 'âœ…'}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button class="action-btn" onclick="openReport('${cap.user}')" title="Ø·Ø¨Ø§Ø¹Ø© ØªÙ‚Ø±ÙŠØ±">ğŸ–¨ï¸</button>
                            <button class="action-btn" onclick="freezeCap('${cap.user}')" title="ØªØ¬Ù…ÙŠØ¯/ØªÙØ¹ÙŠÙ„">${freezeIcon}</button>
                            <button class="action-btn" onclick="deleteCaptain('${cap.user}')" style="color:var(--danger);" title="Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ">ğŸ—‘ï¸</button>
                        </td>
                    </tr>
                `;
            });
        }

        function updateTotalBalance() {
            const total = captains.reduce((sum, c) => sum + parseFloat(c.balance || 0), 0);
            document.getElementById('total-fleet-bal').innerText = total.toFixed(2);
        }

        async function freezeCap(user) {
            const cap = captains.find(c => c.user === user);
            const newStatus = cap.status === 'active' ? 'paused' : 'active';
            if(confirm(`ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØ§Ø¨ØªÙ†ØŸ`)) {
                showLoading(true);
                cap.status = newStatus;
                renderFleet();
                await N_ONE_CORE.postData('update', { user: user, data: { status: newStatus } });
                showLoading(false);
            }
        }

        async function deleteCaptain(user) {
            if(confirm("âš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ÙƒØ§Ø¨ØªÙ† Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
                showLoading(true);
                captains = captains.filter(c => c.user !== user);
                renderFleet();
                await N_ONE_CORE.fetchData('delete', { user: user });
                showLoading(false);
            }
        }

        // --- 5. Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ (Treasury) - Ø§Ù„Ù…ÙŠØ²Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰ ---
        function toggleTreasury() {
            const el = document.getElementById('treasury-modal');
            el.style.display = el.style.display === 'none' ? 'flex' : 'none';
        }

        async function treasuryDeposit() {
            const targetId = document.getElementById('treasury-id').value.trim();
            const amount = parseFloat(document.getElementById('treasury-amount').value);

            if(!targetId || !amount) return alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©");

            showLoading(true);
            
            // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø´Ø§Ù…Ù„ ÙÙŠ allData (ÙŠØ´Ù…Ù„ ÙƒØ¨Ø§ØªÙ† ÙˆÙ…Ø­Ù„Ø§Øª)
            const target = allData.find(u => u.user === targetId || u.cap_phone === targetId);

            if(!target) {
                alert("âŒ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯! ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ.");
                showLoading(false);
                return;
            }

            const typeName = target.type === 'shop' ? 'Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©' : 'Ø§Ù„ÙƒØ§Ø¨ØªÙ†';

            if(!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ÙŠØ¯Ø§Ø¹ Ù…Ø¨Ù„Øº ${amount} Ø¯.Ø£ ÙÙŠ Ø­Ø³Ø§Ø¨ ${typeName}: ${target.name} ØŸ`)) {
                showLoading(false); return;
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯
            const newBal = parseFloat(target.balance || 0) + amount;
            await N_ONE_CORE.postData('update', { user: target.user, data: { balance: newBal } });
            
            alert(`âœ… ØªÙ… Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø¨Ù†Ø¬Ø§Ø­!\nØ§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù€ ${target.name} Ù‡Ùˆ: ${newBal.toFixed(2)} Ø¯.Ø£`);
            
            // ØªÙ†Ø¸ÙŠÙ
            document.getElementById('treasury-id').value = '';
            document.getElementById('treasury-amount').value = '';
            toggleTreasury();
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙƒØ§Ø¨ØªÙ† Ù†Ø­Ø¯Ø« Ø§Ù„Ø¬Ø¯ÙˆÙ„ØŒ Ø¥Ø°Ø§ Ù…Ø­Ù„ Ù…Ø§ Ø¨ÙŠÙ„Ø²Ù… Ù†Ø­Ø¯Ø« Ø§Ù„Ø¬Ø¯ÙˆÙ„
            if (target.type === 'captain') {
                await refreshData();
            } else {
                showLoading(false);
            }
        }

        // --- 6. Ø§Ù„ØªÙ‚Ø±ÙŠØ± ---
        function openReport(user) {
            const cap = captains.find(c => c.user === user);
            if(!cap) return;
            document.getElementById('rep-name').innerText = cap.name;
            document.getElementById('rep-code').innerText = cap.user;
            document.getElementById('rep-phone').innerText = cap.cap_phone;
            document.getElementById('rep-balance').innerText = parseFloat(cap.balance || 0).toFixed(2);
            document.getElementById('rep-date').innerText = new Date().toLocaleDateString();
            
            const tbody = document.getElementById('rep-body');
            tbody.innerHTML = '';
            const myOrders = orders.filter(o => o.cap_name === cap.name || o.cap_phone === cap.cap_phone);
            
            if(myOrders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª Ù…Ø³Ø¬Ù„Ø©</td></tr>';
            } else {
                myOrders.forEach(o => {
                    tbody.innerHTML += `<tr><td style="border:1px solid #e2e8f0; padding:10px;">${o.date.split('T')[0]}</td><td style="border:1px solid #e2e8f0; padding:10px;">ØªÙˆØµÙŠÙ„ Ø·Ù„Ø¨</td><td style="border:1px solid #e2e8f0; padding:10px;">${o.fee} Ø¯.Ø£</td></tr>`;
                });
            }
            document.getElementById('report-modal').style.display = 'flex';
        }
        function closeReport() { document.getElementById('report-modal').style.display = 'none'; }
        
        function toggleTransfer() { alert(document.getElementById('transfer-toggle').checked ? "ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­ÙˆÙŠÙ„" : "ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­ÙˆÙŠÙ„"); }
        function showLoading(show) { document.getElementById('loading-bar').style.width = show ? '100%' : '0%'; }

    </script>
</body>
</html>
