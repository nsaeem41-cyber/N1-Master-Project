<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N1 GLOBAL - MASTER CONTROL</title>
    <style>
        :root { --p: #1a237e; --a: #0288d1; --bg: #f5f7f9; --white: #ffffff; --danger: #d32f2f; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; overflow-x: hidden; }
        
        .header { background: var(--p); color: white; padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .container { max-width: 1100px; margin: 30px auto; padding: 20px; }
        
        .card { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 30px; border-top: 4px solid var(--a); }
        
        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Sidebar) ğŸ˜Š */
        .settings-sidebar {
            position: fixed; top: 0; left: -350px; width: 320px; height: 100%;
            background: var(--white); box-shadow: 5px 0 25px rgba(0,0,0,0.2);
            transition: 0.4s ease; z-index: 1000; padding: 30px; overflow-y: auto;
        }
        .settings-sidebar.active { left: 0; }
        .sidebar-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: none; z-index: 999;
        }

        .close-sidebar { cursor: pointer; color: var(--danger); font-weight: bold; float: right; }
        
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; text-align: right; margin-bottom: 15px; box-sizing: border-box; }
        .btn-action { width: 100%; padding: 13px; background: var(--p); color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        
        table { width: 100%; border-collapse: collapse; background: white; margin-top: 15px; }
        th, td { padding: 15px; border-bottom: 1px solid #eee; text-align: center; }
        th { background: #f8f9fa; color: var(--p); font-size: 13px; }

        .btn-settings { background: var(--a); color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .status-pill { padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; }
    </style>
</head>
<body>

<div class="sidebar-overlay" id="overlay" onclick="closeSettings()"></div>

<div class="settings-sidebar" id="sidebar">
    <span class="close-sidebar" onclick="closeSettings()">Ø¥ØºÙ„Ø§Ù‚ âœ•</span>
    <h3 style="color:var(--p); margin-top:40px;">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</h3>
    <hr>
    <div id="edit-form">
        <label style="font-size:12px; color:var(--p)">Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</label>
        <input type="text" id="edit-name" readonly style="background:#f0f0f0">
        <input type="hidden" id="edit-user">
        
        <label>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
        <input type="number" id="edit-fee" placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
        
        <button class="btn-action" style="background:#2e7d32" onclick="applyStatus('active')">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        <button class="btn-action" style="background:#f57c00" onclick="applyStatus('paused')">Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª</button>
        <button class="btn-action" style="background:var(--danger)" onclick="confirmDelete()">Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹</button>
    </div>
</div>

<header class="header">
    <div style="font-size:20px; font-weight:800;">N1 MASTER SYSTEM</div>
    <div>
        <button class="btn-settings" style="background:transparent; border:1px solid white; margin-left:10px" onclick="toggleLang()">English</button>
        <button class="btn-settings" style="background:var(--danger)" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
    </div>
</header>

<div class="container">
    <div class="card">
        <h3>ØªØ³Ø¬ÙŠÙ„ Ù…Ù†Ø´Ø£Ø© Ø¬Ø¯ÙŠØ¯Ø© ğŸ˜Š</h3>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px">
            <input type="text" id="new-u" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
            <input type="password" id="new-p" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <input type="text" id="new-n" style="grid-column: span 2" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ø±Ø³Ù…ÙŠ">
            <input type="number" id="new-f" placeholder="Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ">
            <select id="new-d">
                <option value="30">30 ÙŠÙˆÙ…</option>
                <option value="90">90 ÙŠÙˆÙ…</option>
                <option value="365">Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø©</option>
            </select>
        </div>
        <button class="btn-action" onclick="saveNew()">Ø­ÙØ¸ ÙˆÙ…Ø²Ø§Ù…Ù†Ø© Ø³Ø­Ø§Ø¨ÙŠØ© ğŸ˜Š</button>
    </div>

    <div class="card">
        <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</h3>
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ø´Ø±ÙƒØ©</th>
                    <th>Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</th>
                </tr>
            </thead>
            <tbody id="p-list"></tbody>
        </table>
    </div>
</div>

<script>
    const API = "https://sheetdb.io/api/v1/qzfkwfzcpbrsm";

    window.onload = loadData;

    async function loadData() {
        const res = await fetch(API);
        const data = await res.json();
        const body = document.getElementById('p-list');
        body.innerHTML = '';
        data.forEach(c => {
            if(c.user) {
                const isPaused = c.status === 'paused';
                body.innerHTML += `
                    <tr>
                        <td style="font-weight:bold">${c.name}</td>
                        <td>${new Date(c.expiry).toLocaleDateString('ar-EG')}</td>
                        <td><span class="status-pill" style="background:${isPaused ? '#fff3e0' : '#e8f5e9'}; color:${isPaused ? '#f57c00' : '#2e7d32'}">
                            ${isPaused ? 'Ù…ÙˆÙ‚Ù' : 'Ù†Ø´Ø·'}</span></td>
                        <td><button class="btn-settings" onclick="openSettings('${c.user}', '${c.name}', '${c.subscription_fee || c.fee}')">âš™ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button></td>
                    </tr>`;
            }
        });
    }

    function openSettings(user, name, fee) {
        document.getElementById('edit-user').value = user;
        document.getElementById('edit-name').value = name;
        document.getElementById('edit-fee').value = fee;
        document.getElementById('sidebar').classList.add('active');
        document.getElementById('overlay').style.display = 'block';
    }

    function closeSettings() {
        document.getElementById('sidebar').classList.remove('active');
        document.getElementById('overlay').style.display = 'none';
    }

    async function applyStatus(s) {
        const u = document.getElementById('edit-user').value;
        await fetch(`${API}/user/${u}`, { method: 'PATCH', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({data:{status:s, fee: document.getElementById('edit-fee').value}}) });
        alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ğŸ˜Š"); closeSettings(); loadData();
    }

    async function confirmDelete() {
        if(confirm("Ù‡Ù„ Ø£Ù†ØªÙ Ù…ØªØ£ÙƒØ¯Ø© Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
            const u = document.getElementById('edit-user').value;
            await fetch(`${API}/user/${u}`, { method: 'DELETE' });
            alert("ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­ ğŸ˜Š"); closeSettings(); loadData();
        }
    }

    async function saveNew() {
        const d = { id: Date.now(), name: document.getElementById('new-n').value, user: document.getElementById('new-u').value, pass: document.getElementById('new-p').value, expiry: new Date(Date.now() + document.getElementById('new-d').value*86400000).toISOString(), status: 'active', fee: document.getElementById('new-f').value, role: 'client' };
        await fetch(API, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({data: [d]}) });
        alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© ğŸ˜Š"); loadData();
    }

    function logout() { localStorage.clear(); window.location.href = 'index.html'; }
    function toggleLang() { /* Ù…Ù†Ø·Ù‚ Ø§Ù„Ù„ØºØ§Øª ğŸ˜Š */ }
</script>
</body>
</html>
