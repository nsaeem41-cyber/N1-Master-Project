<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N One | ØºØ±ÙØ© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© + AI 555</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/nsaeem41-cyber/N1-Master-Project@main/n-one-core.js"></script>

    <style>
        /* ================= Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„ØªØµÙ…ÙŠÙ… (Pro Theme) ================= */
        :root {
            --primary: #1a237e; --gold: #d4af37; --bg: #f4f7f6; --text: #333;
            --success: #2e7d32; --danger: #c62828; --warning: #f57f17;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg); margin: 0; padding: 0; color: var(--text); user-select: none; }

        .navbar { background: white; height: 70px; display: flex; justify-content: space-between; align-items: center; padding: 0 30px; box-shadow: 0 2px 15px rgba(0,0,0,0.05); border-bottom: 3px solid var(--gold); position: sticky; top: 0; z-index: 1000; }
        .brand { font-size: 24px; font-weight: 900; color: var(--primary); letter-spacing: 1px; }
        .gold-text { color: var(--gold); }
        .nav-actions button { background: none; border: none; font-size: 16px; cursor: pointer; margin-left: 15px; padding: 8px 15px; border-radius: 8px; transition: 0.3s; }
        .btn-settings { color: #555; background: #eee !important; }
        .btn-logout { background-color: var(--danger) !important; color: white; }

        .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }

        /* ÙƒØ±ÙˆØª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.03); text-align: center; border-top: 5px solid var(--primary); transition: 0.3s; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-number { font-size: 36px; font-weight: bold; color: var(--primary); margin: 10px 0; }
        .stat-label { color: #777; font-size: 14px; }

        /* ğŸ§  Ù‚Ø³Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ 555 Ø§Ù„Ø¬Ø¯ÙŠØ¯ ğŸ§  */
        .ai-section {
            background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
            color: white; padding: 25px; border-radius: 20px; margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(26, 35, 126, 0.2); border: 2px solid #d4af37;
        }
        .ai-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .ai-title { font-size: 20px; font-weight: bold; display: flex; align-items: center; gap: 10px; }
        .ai-badge { background: #d4af37; color: #1a237e; padding: 5px 12px; border-radius: 15px; font-size: 12px; font-weight: bold; }
        
        .recommendation-card {
            background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;
            margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;
            border-right: 4px solid #d4af37;
        }
        .rec-info { font-size: 14px; }
        .rec-btn {
            background: #d4af37; color: #1a237e; border: none; padding: 8px 15px;
            border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .rec-btn:hover { background: white; }

        /* Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
        .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.03); margin-bottom: 30px; }
        .card-header { font-size: 20px; font-weight: bold; color: var(--primary); border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; outline: none; background: #fafafa; }
        input:focus { border-color: var(--primary); background: white; }
        .btn-add { background: var(--success); color: white; border: none; padding: 12px 25px; border-radius: 8px; font-weight: bold; cursor: pointer; height: 100%; width: 100%; }
        
        .table-wrapper { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        thead { background: #f8f9fa; color: #555; font-weight: bold; }
        th, td { padding: 15px; text-align: right; border-bottom: 1px solid #eee; }
        .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .status-active { background: #e8f5e9; color: var(--success); }
        .status-paused { background: #fff3e0; color: var(--warning); }
        .status-expired { background: #ffebee; color: var(--danger); } 
        .action-btn { padding: 6px 12px; border-radius: 6px; border: none; color: white; cursor: pointer; font-size: 12px; margin-left: 5px; }
        .act-freeze { background: var(--warning); } .act-active { background: var(--success); } .act-delete { background: var(--danger); } .act-renew { background: var(--primary); }

        #loader-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 3000; justify-content: center; align-items: center; font-size: 24px; font-weight: bold; color: var(--primary); }
    </style>
</head>
<body>

    <div id="loader-overlay">Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ... ğŸ§ </div>

    <nav class="navbar">
        <div class="brand">N <span class="gold-text">One</span> Admin</div>
        <div class="nav-actions">
            <button class="btn-settings">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            <button class="btn-logout" onclick="logout()">Ø®Ø±ÙˆØ¬ ğŸ”’</button>
        </div>
    </nav>

    <div class="container">
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ø±ÙƒØ§Øª</div>
                <div class="stat-number" id="total-count">0</div>
            </div>
            <div class="stat-card" style="border-top-color: var(--success);">
                <div class="stat-label">Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ù†Ø´Ø·Ø©</div>
                <div class="stat-number" id="active-count" style="color: var(--success);">0</div>
            </div>
            <div class="stat-card" style="border-top-color: var(--gold);">
                <div class="stat-label">Ø§Ù„Ù…Ø±Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø§Ù„ÙŠ</div>
                <div class="stat-number" id="revenue-count" style="color: var(--gold);">0</div>
            </div>
        </div>

        <div class="ai-section">
            <div class="ai-header">
                <div class="ai-title">ğŸ“¡ Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø°ÙƒÙŠ (System 555)</div>
                <div class="ai-badge">AI Active</div>
            </div>
            <div id="ai-recommendations">
                <p style="font-size:13px; opacity:0.8;">Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙƒØ¨Ø§ØªÙ† ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <span>âœ¨ Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©</span>
            </div>
            <div class="form-grid">
                <input type="text" id="new_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©">
                <input type="text" id="new_user" placeholder="User ID">
                <input type="password" id="new_pass" placeholder="Password">
                <select id="sub_duration">
                    <option value="30">30 ÙŠÙˆÙ…</option>
                    <option value="90">3 Ø£Ø´Ù‡Ø±</option>
                    <option value="365">Ø³Ù†Ø© VIP</option>
                </select>
                <input type="number" id="sub_price" placeholder="Ø§Ù„Ø³Ø¹Ø±">
                <button class="btn-add" onclick="addClient()">+ ØªÙØ¹ÙŠÙ„</button>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Ø³Ø¬Ù„ Ø§Ù„Ø´Ø±ÙƒØ§Øª ÙˆØ§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</div>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø´Ø±ÙƒØ©</th>
                            <th>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
                            <th>Ø§Ù„Ø³Ø¹Ø±</th>
                            <th>Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„ØªØ­ÙƒÙ…</th>
                        </tr>
                    </thead>
                    <tbody id="clients-table">
                        <tr><td colspan="6" style="text-align:center;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let allData = [];
        let currentUser = null;

        window.onload = async function() {
            if (typeof N_ONE_CORE === 'undefined') { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ØµÙ„Ø­ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ"); return; }
            
            currentUser = N_ONE_CORE.checkSession('admin');
            if (currentUser) {
                await fetchData();
            }
        };

        async function fetchData() {
            try {
                // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ù…ØµÙ„Ø­ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ
                allData = await N_ONE_CORE.fetchData('read');
                
                renderTable(); // Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ…
                runSmartRadar555(); // ğŸ§  ØªØ´ØºÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                
            } catch (e) {
                console.error(e);
            }
        }

        // ğŸ§  Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ 555 ğŸ§ 
        function runSmartRadar555() {
            const aiContainer = document.getElementById('ai-recommendations');
            aiContainer.innerHTML = '';

            // 1. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙ‚Ø·
            const orders = allData.filter(item => item.type === 'order');
            
            // 2. ØªØ¬Ù…ÙŠØ¹ Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙƒØ¨Ø§ØªÙ†
            let captainsStats = {};
            orders.forEach(order => {
                const capName = order.cap_name || "Unknown";
                if (!captainsStats[capName]) {
                    captainsStats[capName] = { count: 0, totalVal: 0 };
                }
                captainsStats[capName].count++;
                captainsStats[capName].totalVal += Number(order.val || 0);
            });

            // 3. ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†Ø®Ø¨Ø© (Ù…Ø¹ÙŠØ§Ø± 555)
            // Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„ØªØ¬Ø±Ø¨Ø©: Ø£ÙƒØ«Ø± Ù…Ù† 5 Ø·Ù„Ø¨Ø§Øª (ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹Ù‡ Ù„Ù€ 50 Ù„Ø§Ø­Ù‚Ø§Ù‹)
            const eliteCaptains = Object.entries(captainsStats).filter(([name, stat]) => stat.count >= 5);

            if (eliteCaptains.length === 0) {
                aiContainer.innerHTML = '<p style="font-size:13px; opacity:0.8;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙˆØµÙŠØ§Øª Ø­Ø§Ù„ÙŠØ§Ù‹. Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª ğŸš€</p>';
                return;
            }

            eliteCaptains.forEach(([name, stat]) => {
                const card = document.createElement('div');
                card.className = 'recommendation-card';
                card.innerHTML = `
                    <div class="rec-info">
                        <strong>ğŸ… ÙƒØ§Ø¨ØªÙ† Ù…Ù…ÙŠØ²: ${name}</strong><br>
                        Ø£Ù†Ø¬Ø² ${stat.count} Ø·Ù„Ø¨ | Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªØ­ØµÙŠÙ„ ${stat.totalVal} Ø¯.Ø£
                    </div>
                    <button class="rec-btn" onclick="alert('ØªÙ… Ù†Ø³Ø® ØªÙˆØµÙŠØ© Ø§Ù„ØªÙƒØ±ÙŠÙ… Ù„Ù„ÙƒØ§Ø¨ØªÙ† ${name} âœ…\\nÙÙƒØ±Ø© 555: ÙŠÙˆÙ… Ø¥Ø¬Ø§Ø²Ø© Ù…ÙÙ‡Ø¯Ù‰!')">
                        Ø¥ØµØ¯Ø§Ø± ØªÙˆØµÙŠØ© 555 ğŸ
                    </button>
                `;
                aiContainer.appendChild(card);
            });
        }

        // ==========================================
        // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ù„Ù… ÙŠØªÙ… ØªØºÙŠÙŠØ±Ù‡Ø§)
        // ==========================================

        function renderTable() {
            const tbody = document.getElementById('clients-table');
            const clients = allData.filter(u => u.role === 'client').reverse();
            
            document.getElementById('total-count').innerText = clients.length;
            document.getElementById('active-count').innerText = clients.filter(c => c.status === 'active').length;
            let totalRev = 0;
            clients.forEach(c => totalRev += Number(c.price || 0));
            document.getElementById('revenue-count').innerText = totalRev.toFixed(0);

            if (clients.length === 0) { tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">Ù„Ø§ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>'; return; }

            tbody.innerHTML = '';
            clients.forEach(client => {
                const expiryDate = new Date(client.expiry);
                const diffTime = expiryDate - new Date();
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                let statusBadge = client.status === 'active' ? '<span class="status-badge status-active">Ù†Ø´Ø·</span>' : '<span class="status-badge status-paused">Ù…Ø¬Ù…Ø¯</span>';
                if(diffDays <= 0) statusBadge = '<span class="status-badge status-expired">Ù…Ù†ØªÙ‡ÙŠ</span>';

                const row = `<tr>
                    <td><b>${client.name}</b></td>
                    <td>${client.user}</td>
                    <td>${client.price}</td>
                    <td>${diffDays} ÙŠÙˆÙ…</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="action-btn act-freeze" onclick="setStatus('${client.user}', 'paused')">â„ï¸</button>
                        <button class="action-btn act-delete" onclick="deleteClient('${client.user}')">âŒ</button>
                    </td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        async function addClient() {
            const btn = document.querySelector('.btn-add');
            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„..."; btn.disabled = true;
            
            const newClient = {
                id: "CL_" + Date.now(),
                user: document.getElementById('new_user').value,
                pass: document.getElementById('new_pass').value,
                name: document.getElementById('new_name').value,
                role: "client", type: "client", status: "active",
                expiry: new Date(Date.now() + document.getElementById('sub_duration').value * 86400000).toISOString().split('T')[0],
                price: document.getElementById('sub_price').value,
                plan_days: document.getElementById('sub_duration').value
            };

            await N_ONE_CORE.postData('add', [newClient]);
            await fetchData();
            btn.innerText = "+ ØªÙØ¹ÙŠÙ„"; btn.disabled = false;
            alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­ â˜ºï¸");
        }

        async function setStatus(u, s) {
            if(!confirm('ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©ØŸ')) return;
            await N_ONE_CORE.postData('update', { user: u, data: { status: s } });
            await fetchData();
        }

        async function deleteClient(u) {
            if(!confirm('Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØŸ')) return;
            await N_ONE_CORE.fetchData('delete', { user: u });
            await fetchData();
        }

        function logout() { N_ONE_CORE.logout(); }
    </script>

</body>
</html>
