<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N1 Global - Master Admin Dashboard</title>
    <style>
        :root {
            --primary-dark: #1a237e;
            --accent-blue: #0288d1;
            --success-green: #2e7d32;
            --warning-orange: #f57c00;
            --danger-red: #d32f2f;
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --white: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-gradient);
            background-attachment: fixed;
            margin: 0;
            color: #2c3e50;
        }

        /* Navigation Bar - Same as Index */
        .navbar {
            background: var(--white);
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .brand-logo {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary-dark);
            letter-spacing: 1px;
        }

        .nav-btns { display: flex; gap: 15px; }

        .btn-lang {
            background: transparent;
            border: 1px solid var(--primary-dark);
            padding: 8px 18px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.3s;
        }

        .btn-logout {
            background: var(--danger-red);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 700;
        }

        .container {
            max-width: 1100px;
            margin: 40px auto;
            padding: 0 20px;
        }

        /* Card Style - Same as Index */
        .admin-card {
            background: var(--white);
            padding: 40px;
            border-radius: 4px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border-top: 5px solid var(--primary-dark);
        }

        h2 { color: var(--primary-dark); border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 30px; font-size: 22px; }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .input-wrapper { margin-bottom: 15px; text-align: right; }

        label { display: block; font-size: 12px; font-weight: 700; margin-bottom: 8px; color: var(--primary-dark); text-transform: uppercase; }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #dee2e6;
            border-radius: 3px;
            box-sizing: border-box;
            background: #fcfcfc;
            text-align: right;
        }

        .action-btn-main {
            width: 100%;
            padding: 15px;
            background: var(--primary-dark);
            color: white;
            border: none;
            border-radius: 3px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 20px;
            transition: 0.3s;
        }

        /* Table Design */
        .table-responsive { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 15px; text-align: center; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; color: var(--primary-dark); font-size: 13px; text-transform: uppercase; }

        .status-pill { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 700; }
        .status-active { background: #e8f5e9; color: var(--success-green); }
        .status-paused { background: #fff3e0; color: var(--warning-orange); }

        .control-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            color: white;
            margin: 2px;
            transition: 0.2s;
        }

        #sync-msg { display: none; padding: 15px; margin-top: 20px; border-radius: 3px; text-align: center; font-weight: 600; }
    </style>
</head>
<body>

<nav class="navbar">
    <div class="brand-logo">N1 GLOBAL ADMIN</div>
    <div class="nav-btns">
        <button class="btn-lang" id="lang-btn" onclick="changeAdminLang()">English</button>
        <button class="btn-logout" id="logout-text" onclick="terminateSession()">Ø®Ø±ÙˆØ¬</button>
    </div>
</nav>

<div class="container">
    <div class="admin-card">
        <h2 id="reg-title">Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠÙƒ Ù„ÙˆØ¬Ø³ØªÙŠ Ø¬Ø¯ÙŠØ¯</h2>
        <div class="form-grid">
            <div class="input-wrapper">
                <label id="l-u">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                <input type="text" id="username" placeholder="Company Username">
            </div>
            <div class="input-wrapper">
                <label id="l-p">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input type="password" id="password" placeholder="Password">
            </div>
            <div class="input-wrapper">
                <label id="l-n">Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©</label>
                <input type="text" id="company" placeholder="Full Company Name">
            </div>
            <div class="input-wrapper">
                <label id="l-d">Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
                <select id="duration">
                    <option value="1">Ø´Ù‡Ø± ÙˆØ§Ø­Ø¯</option>
                    <option value="3">3 Ø£Ø´Ù‡Ø±</option>
                    <option value="12">Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø©</option>
                </select>
            </div>
            <div class="input-wrapper" style="grid-column: span 2;">
                <label id="l-f">Ø±Ø³ÙˆÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (JOD)</label>
                <input type="number" id="fee" placeholder="0.00">
            </div>
        </div>
        <button class="action-btn-main" id="sync-btn" onclick="syncNewPartner()">Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆÙ…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <div id="sync-msg"></div>
    </div>

    <div class="admin-card">
        <h2 id="list-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø±ÙƒØ§Øª ÙˆØ§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù„Ø­Ø¸ÙŠ</h2>
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th id="th-name">Ø§Ù„Ø´Ø±ÙƒØ©</th>
                        <th id="th-user">Ø§Ù„ÙŠÙˆØ²Ø±</th>
                        <th id="th-fee">Ø§Ù„Ø±Ø³ÙˆÙ…</th>
                        <th id="th-stat">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th id="th-act">Ø§Ù„ØªØ­ÙƒÙ…</th>
                    </tr>
                </thead>
                <tbody id="partners-list">
                    </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const API = "https://sheetdb.io/api/v1/zuo2qyjeryhxm";
    let currentLang = 'ar';

    window.onload = () => {
        const user = JSON.parse(localStorage.getItem('loggedInUser'));
        if(!user || user.role !== 'admin') window.location.href = 'index.html';
        loadPartners();
    };

    async function loadPartners() {
        try {
            const res = await fetch(API);
            const data = await res.json();
            const list = document.getElementById('partners-list');
            list.innerHTML = '';
            
            data.filter(i => i.role === 'client').forEach(item => {
                const row = `
                    <tr>
                        <td style="font-weight:700">${item.company_name}</td>
                        <td>${item.username}</td>
                        <td>${item.subscription_fee} JOD</td>
                        <td><span class="status-pill ${item.status === 'paused' ? 'status-paused' : 'status-active'}">
                            ${currentLang === 'ar' ? (item.status === 'paused' ? 'Ù…ÙˆÙ‚Ù' : 'Ù†Ø´Ø·') : (item.status === 'paused' ? 'PAUSED' : 'ACTIVE')}
                        </span></td>
                        <td>
                            <button class="control-btn" style="background:#2e7d32" onclick="updatePartnerStatus('${item.username}', 'active')">âœ“</button>
                            <button class="control-btn" style="background:#f57c00" onclick="updatePartnerStatus('${item.username}', 'paused')">Ã—</button>
                            <button class="control-btn" style="background:#d32f2f" onclick="deletePartner('${item.username}')">Delete</button>
                        </td>
                    </tr>
                `;
                list.innerHTML += row;
            });
        } catch (e) { console.error("Load failed"); }
    }

    async function syncNewPartner() {
        const btn = document.getElementById('sync-btn');
        btn.disabled = true;
        
        const payload = { data: [{
            username: document.getElementById('username').value,
            password: document.getElementById('password').value,
            company_name: document.getElementById('company').value,
            subscription_fee: document.getElementById('fee').value,
            duration: document.getElementById('duration').value,
            role: 'client',
            status: 'active'
        }]};

        await fetch(API, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload) });
        document.getElementById('sync-msg').style.display = 'block';
        document.getElementById('sync-msg').style.background = '#e8f5e9';
        document.getElementById('sync-msg').innerText = "ØªÙ…Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­ ğŸ˜Š";
        btn.disabled = false;
        loadPartners();
    }

    async function updatePartnerStatus(user, newStatus) {
        await fetch(`${API}/username/${user}`, {
            method: 'PATCH',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({data: {status: newStatus}})
        });
        loadPartners();
    }

    async function deletePartner(user) {
        if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø´Ø±ÙŠÙƒ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
            await fetch(`${API}/username/${user}`, { method: 'DELETE' });
            loadPartners();
        }
    }

    function changeAdminLang() {
        currentLang = currentLang === 'ar' ? 'en' : 'ar';
        const isAr = currentLang === 'ar';
        document.documentElement.dir = isAr ? 'rtl' : 'ltr';
        document.getElementById('lang-btn').innerText = isAr ? 'English' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
        // ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªØ±Ø¬Ù…Ø§Øª Ù‡Ù†Ø§ ÙŠØ§ Ø±ÙˆØ­ÙŠ Ø¨Ù†ÙØ³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© ğŸ˜Š
        loadPartners();
    }

    function terminateSession() {
        localStorage.clear();
        window.location.href = 'index.html';
    }
</script>
</body>
</html>
